Most.js source for a `map` function in a view
---------

Inspired by https://gist.github.com/briancavalier/f26f95d5cff9ff4fda249822eb1282ae

    class viewSource
      constructor: (map_function,@doc) ->

      run: (sink, scheduler) ->
        emit = (key,value) =>

Emulate a row as reported with `include_docs`.

          sink.event scheduler.now(), {id:@doc._id,key,value,doc}
        try
          map_function(emit) doc
        catch error
          sink.error scheduler.now(), error
        sink.end scheduler.now()
        return

Maps results from a changes stream into a view
-----------

The view is evaluated locally.

The `db_changes` stream is generated by e.g. `all_changes`.

    changes_view = (map_function,db_changes) ->
      db_changes
      .chain ({doc}) ->
        new Stream map_function, new viewSource doc

    module.exports = changes_view
